(!window.flitsApp||window.flitsApp===void 0)&&(window.flitsApp={}),window.flitsApp.formatMoney=function(a,k){function u(t,e){return t===void 0?e:t}function _(t,e,o,r){if(e=u(e,2),o=u(o,","),r=u(r,"."),isNaN(t)||t==null)return 0;var i=(t=(t/100).toFixed(e)).split(".");return i[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+o)+(i[1]?r+i[1]:"")}typeof a=="string"&&(a=a.replace(".",""));var p="",S=/\{\{\s*(\w+)\s*\}\}/,v=k||"${{amount}}";switch(v.match(S)[1]){case"amount":p=_(a,2);break;case"amount_no_decimals":p=_(a,0);break;case"amount_with_comma_separator":p=_(a,2,".",",");break;case"amount_no_decimals_with_comma_separator":p=_(a,0,".",",")}return v.replace(S,p)},window.flitsApp.credit_on_shipping_method=function(){var a=this;if(this.customer_id="",this.customer_url="",this.token="",this.moneyFormat="",this.select_div="",this.select_format="",this.store_credit_applied="",this.cart_data={},this.spent_rules={},this.applied_discount_code_span=".applied-reduction-code__information",document.querySelector(".reduction-code__text")&&(this.applied_discount_code_span=".reduction-code__text"),this.get_ajax_obj=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP")},this.serialize=function(t){var e=[];for(var o in t)t.hasOwnProperty(o)&&e.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return e.join("&")},this.generate_code=function(t){for(var e=this,o=e.money_format,r=t.total_credits,i=t.rules,n=0;n<i.length;n++){var d=i[n].applicable_credits,s=i[n].rule.id,c="You can use {{ credit }} credits out of {{ total_credit }}.";switch(i[n].rule.rule.column.name){case"cart_value":c=e.spent_rules.credit_cart_percentage.replace("{{ credit }}",window.flitsApp.formatMoney(Math.abs(d),o)),c=c.replace("{{ total_credit }}",window.flitsApp.formatMoney(Math.abs(r),o));break;case"checkout_shipping":c=e.spent_rules.free_shipping_rule;break;default:c=c.replace("{{ credit }}",window.flitsApp.formatMoney(Math.abs(d),o)),c=c.replace("{{ total_credit }}",window.flitsApp.formatMoney(Math.abs(r),o));break}var h=document.createElement("option");h.value=s,h.innerHTML=c,e.select_format.querySelector('select option[value="'+s+'"]')||e.select_format.querySelector("select").appendChild(h)}i.length<=0&&(e.select_format.style.display="none")},this.add_checkbox_code=function(){if(!document.querySelector("#flits-use-credit-div"))for(var t=document.querySelectorAll('form input[name="checkout[reduction_code]"]'),e=0;e<t.length;e++){var o=t[e].closest("form");if(o){var r=a.select_div.cloneNode(!0);o.parentElement.parentNode.insertBefore(r,o.parentElement.nextSibling)}}},this.getCookie=function(t){for(var e=t+"=",o=decodeURIComponent(document.cookie),r=o.split(";"),i=0;i<r.length;i++){for(var n=r[i];n.charAt(0)==" ";)n=n.substring(1);if(n.indexOf(e)==0)return n.substring(e.length,n.length)}return""},this.setCookie=function(t,e,o){var r=new Date;r.setTime(r.getTime()+o*24*60*60*1e3);var i="expires="+r.toUTCString();document.cookie=t+"="+e+";"+i+";path=/"},this.isNull=function(t){return t===void 0||t==null||t.toString().trim()==""},this.get_credit=function(t){var e=this,o=e.customer_url+"/get_credit";if(Shopify&&Shopify.Checkout.step==e.step_name){var r=e.get_ajax_obj();r.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var h=JSON.parse(this.responseText),f=document.createElement("div");if(f.id="flits-use-credit-div",f.style.marginBottom="1.5em",e.generate_code(h.code),e.select_div=f,e.select_div.append(e.select_format),h.is_credit_on_checkout==1){var g=e.getCookie("flits_discount_code"),y=document.querySelector(e.applied_discount_code_span);if(e.isNull(g)||e.isNull(y)?e.add_checkbox_code():g==y.innerHTML||e.add_checkbox_code(),!e.isNull(t)){var w=t.step;switch(w){case"remove_code":var b=setInterval(function(){var l=window.flitsApp.credit_on_shipping_obj,m=document.querySelector(l.applied_discount_code_span),q=l.getCookie("flits_discount_code");l.isNull(m)?(clearInterval(b),l.add_checkbox_code()):q==m.innerHTML||(clearInterval(b),l.add_checkbox_code())},100);break;case"apply_code":var b=setInterval(function(){var l=window.flitsApp.credit_on_shipping_obj,m=document.querySelector(l.applied_discount_code_span),q=l.getCookie("flits_discount_code");l.isNull(m)||(clearInterval(b),l.add_checkbox_code())},100);break;default:break}}}}},r.open("POST",o,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded");var i=e.cart_data;e.isNull(i.token)||(Object.defineProperty(i,"cart_token",Object.getOwnPropertyDescriptor(i,"token")),delete i.token);for(var n=["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"],d=0;d<i.items.length;d++)for(var s=0;s<n.length;s++)e.isNull(i.items[d][n[s]])||delete i.items[d][n[s]];var c=e.serialize({customer_hash:window.flitsApp.credit_on_shipping_obj.customer_hash,token:e.token,cart:btoa(unescape(encodeURIComponent(JSON.stringify(i)))),customer_id:e.customer_id,shipping_price:e.get_shipping_price()});r.send(c)}},this.get_shipping_price=function(){var t=document.querySelector("[data-checkout-total-shipping-target]");return t?t.getAttribute("data-checkout-total-shipping-target"):0},this.getCartData=function(t,e){var o=this,r="/cart.json",i=o.get_ajax_obj();i.onreadystatechange=function(){if(this.readyState==4)if(this.status==200){if(typeof t=="function"){var n=JSON.parse(this.responseText);t(n)}}else typeof e=="function"&&e()},i.open("GET",r,!0),i.send()},this.getFormData=function(t){for(var e=t.querySelectorAll("[name]"),o={},r=0;r<e.length;r++)o[e[r].name]=e[r].value;return a.serialize(o)},this.applyCreditClickEvent=function(){document.addEventListener("click",function(t){var e=t.target,o=e,r=window.flitsApp.credit_on_shipping_obj;if(e.classList.contains("apply-flits-credit")){var i=!1,n=e.closest("#flits-use-credit-div").querySelector("#flits-want-to-use-credit"),d=-1;if(n&&n.tagName.toString().toLowerCase()=="select"?i=!1:i=!0,i&&n.checked)t.preventDefault();else if(!i&&n.value!=="-1")d=n.value,t.preventDefault();else return!0;o.setAttribute("disabled",!0),o.classList.add("btn--loading"),r.getCartData(function(s){var c="/credit/apply_credit",h=r.token;c=r.customer_url+c;var f=r.get_ajax_obj();f.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var l=JSON.parse(this.responseText);if(o.setAttribute("disabled",!1),l.status){var m=document.querySelector('input[name="checkout[reduction_code]"]').cloneNode(!0);m.type="hidden",m.value=l.code,document.querySelector('input[name="checkout[reduction_code]"]').closest("form").appendChild(m),document.querySelector('input[name="checkout[reduction_code]"]').closest("form").submit(),o.querySelector(".btn__applied").style.display="inline-block",o.querySelector(".btn__spinner").style.display="none",o.querySelector(".btn__content").style.display="none",r.setCookie("flits_discount_code",l.code,3)}}},f.open("POST",c,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),Object.defineProperty(s,"cart_token",Object.getOwnPropertyDescriptor(s,"token")),delete s.token;for(var g=["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"],y=0;y<s.items.length;y++)for(var w=0;w<g.length;w++)r.isNull(s.items[y][g[w]])||delete s.items[y][g[w]];var b="token="+h+"&customer_hash="+window.flitsApp.credit_on_shipping_obj.customer_hash+"&data="+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+"&spent_rule_id="+d+"&shipping_price="+r.get_shipping_price();f.send(b)},function(){location.href="/checkout"})}}),document.addEventListener("submit",function(t){var e=t.target,o=window.flitsApp.credit_on_shipping_obj;return o.isNull(e.querySelector("#checkout_clear_discount"))||o.get_credit({step:"remove_code"}),o.isNull(e.querySelector("#checkout_reduction_code"))||o.get_credit({step:"apply_code"}),!0})},this.addEventToGoPaymentBtn=function(){var t=this,e=document.querySelector('[data-trekkie-id="continue_to_payment_method_button"]');if(e){var o=t.getCookie("flits_discount_code"),r=document.querySelector(t.applied_discount_code_span)?document.querySelector(t.applied_discount_code_span).innerHTML:null;if(o&&r&&r==o&&document.querySelector(".applied-reduction-code__clear-button")){var i=document.querySelector(".applied-reduction-code__clear-button").closest("form");i.submit()}}},this.step_name="payment_method",Shopify&&Shopify.Checkout.step==this.step_name){var k=location.origin+"/?view=flits_customer_data",u=this.get_ajax_obj();u.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var t=this.responseText,e=new DOMParser,o=e.parseFromString(t,"text/html"),r=JSON.parse(o.querySelector(".flits-checkout-data").innerHTML),i=o.querySelector(".flits-checkout-select-credit-div");a.customer_id=r.customer_id,a.customer_url=r.customer_url,window.flitsApp.credit_on_shipping_obj.customer_hash=r.customer_hash,a.token=r.token,a.money_format=o.querySelector("#flits-money-format").value,a.select_format=i,a.spent_rules=r.spent_rules,a.store_credit_applied=r.store_credit_applied,a.getCartData(function(n){var d=window.flitsApp.credit_on_shipping_obj;d.cart_data=n,d.get_credit(),d.applyCreditClickEvent()},function(){})}},u.open("GET",k,!0),u.send()}if(Shopify&&Shopify.Checkout.step=="shipping_method"&&a.addEventToGoPaymentBtn(),Shopify){var _=a.getCookie("flits_discount_code"),p=document.querySelector(a.applied_discount_code_span)?document.querySelector(a.applied_discount_code_span).innerHTML:null;if(_&&p&&p==_){var S=document.querySelector(".total-line-table "+a.applied_discount_code_span).parentNode,v=document.createElement("span");v.innerHTML="Store Credit Applied",v.className="flits-store-credit-information",S.appendChild(v),document.querySelector(".total-line-table "+a.applied_discount_code_span).style.display="none";var k=location.origin+"/?view=flits_customer_data",u=this.get_ajax_obj();u.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var o=this.responseText,r=new DOMParser,i=r.parseFromString(o,"text/html"),n=JSON.parse(i.querySelector(".flits-checkout-data").innerHTML);v.innerHTML=n.store_credit_applied;var d=setInterval(function(){if(_&&p&&p==_&&document.querySelector(".total-line-table "+a.applied_discount_code_span)){var s=document.querySelector(".total-line-table "+a.applied_discount_code_span).parentNode;if(!s.querySelector(".flits-store-credit-information")){var c=document.createElement("span");c.innerHTML=n.store_credit_applied,c.className="flits-store-credit-information",s.appendChild(c),document.querySelector(".total-line-table "+a.applied_discount_code_span).style.display="none"}}},100)}},u.open("GET",k,!0),u.send()}}},window.flitsApp.credit_on_shipping_obj=new window.flitsApp.credit_on_shipping_method;
//# sourceMappingURL=/s/files/1/0693/3459/7926/t/6/assets/flits_checkout.js.map?v=1676150728
