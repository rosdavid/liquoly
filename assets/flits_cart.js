(function(t){var h=t.StoreCreditCart=function(m){t.StoreCreditCart.settings={};var C={get_spent_rules_route:"/get_credit",apply_credit_route:"/credit/apply_credit",delete_discounts_route:"/delete-discounts",main_div_class:"flits-credit-code-div",creditDropdownClass:"flits-want-to-use-credit flits-input",checkoutButtonSelectors:["input[name='checkout']","button[name='checkout']","[href$='checkout']"],checkoutFormSelectors:["form[action$='/cart'][method='post']"],updateCartButtonSelectors:["form[action$='/cart'] input[name='update']","form[action$='/cart'] button[name='update']"],isCodeAutomatic:!0,automaticCodeDiv:"#flits-cart-automatic-code",checkoutButtonParameterValue:"store-credit-added",checkoutButtonParentParameterValue:"store-credit-parent",automaticAppendDivFunction:function(){},isAjaxCart:!0,isApplyCreditChecked:!1,isProcessCheckout:!0,isDeleteDiscount:!0,removeAttributesFromCart:["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"],creditDropDownHtml:'<div id="flits-cart-automatic-code" style="display:none;"> <div class="flits-credit-code-div flits-template"></div> </div>'};C=t.extend(t.StoreCreditCart.settings,C,m),t.dispatchEvent("Flits:StoreCreditCart:Loaded",{settings:C});function n(e){var r=t.money_format,o=e.total_credits;if(o<=0)return"";var a=e.rules;if(a.length<=0)return"";var i=t("<div class='flits-select-row flits-cart-drp'/>"),d=t("<select class='"+t.StoreCreditCart.settings.creditDropdownClass+"' />");i.append('<div class="flits-select-arrow"><svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M6 9l6 6 6-6"></path></svg></div>'),a.length>0&&d.append("<option value='-1'>"+t.t("Flits.locals.cart_page.select_credit_option","Select option to use store credit")+"</option>");for(var c=0;c<a.length;c++){var f=a[c].applicable_credits,w=a[c].rule.id,u="You can use {{ credit }} credit out of {{ total_credit }}.";switch(a[c].rule.rule.column.name){case"cart_value":u=t.t("Flits.locals.cart_page.credit_cart_percentage","You can use {{ credit }} credit out of {{ total_credit }}.").replace("{{ credit }}",t.formatMoney(Math.abs(f),r)),u=u.replace("{{ total_credit }}",t.formatMoney(Math.abs(o),r));break;default:u=u.replace("{{ credit }}",t.formatMoney(Math.abs(f),r)),u=u.replace("{{ total_credit }}",t.formatMoney(Math.abs(o),r));break}d.append("<option value='"+w+"'>"+u+"</option>")}return i.append(d),t(i)}function s(e){if(!(e.total_price<=0)){e=l(e);var r=t.getLocalStorage("lastLoadedCart");if(t.compareObject(r,e)){var o=t.getLocalStorage("lastLoadedSpentRules");return p(o,!0),!0}t.setLocalStorage("lastLoadedCart",e);var a=[t.base_url,t.customer_id].join("/")+t.StoreCreditCart.settings.get_spent_rules_route;t.ajax({url:a,method:"POST",data:{customer_hash:t.customerHash,token:t.token,cart:btoa(unescape(encodeURIComponent(JSON.stringify(e))))}}).done(function(i){p(i,!1)})}}function p(e,r){if(t.setLocalStorage("lastLoadedSpentRules",e),e.is_credit_on_cart!="0"&&!r){var o=n(e.code);t("."+t.StoreCreditCart.settings.main_div_class).appendStoreCreditDropDown(o)}}function v(e){if(e.total_price<=0)return t.redirectToCheckout({discount:"+"}),!1;var r=t.StoreCreditCart.settings.checkoutProcessData;if(t.isEmptyObject(r)||r.spentRuleId==-1||!r.spentRuleId)return t.redirectToCheckout({discount:"+"}),!1;e=l(e);var o=[t.base_url,t.customer_id].join("/")+t.StoreCreditCart.settings.apply_credit_route;t.ajax({url:o,method:"post",data:{customer_hash:t.customerHash,token:t.token,data:btoa(unescape(encodeURIComponent(JSON.stringify(e)))),spent_rule_id:r.spentRuleId}}).done(function(a){if(!a.status){t.redirectToCheckout({discount:"+"});return}t.redirectToCheckout({discount:a.code})}).fail(function(){t.redirectToCheckout({discount:"+"})})}function S(){var e=[t.base_url,t.customer_id].join("/")+t.StoreCreditCart.settings.delete_discounts_route;return t.ajax({url:e,method:"post",data:{customer_hash:t.customerHash,token:t.token}})}function l(e){Object.defineProperty(e,"cart_token",Object.getOwnPropertyDescriptor(e,"token")),delete e.token;for(var r=t.StoreCreditCart.settings.removeAttributesFromCart,o=0;o<e.items.length;o++)for(var a=0;a<r.length;a++)t.isNull(e.items[o][r[a]])||delete e.items[o][r[a]];return e}function k(e,r){if(b(),!t.StoreCreditCart.settings.isProcessCheckout)return!1;var o=r.closest('[data-flits="'+t.StoreCreditCart.settings.checkoutButtonParentParameterValue+'"]');if(!o)return!0;var a=t(o).find(".flits-want-to-use-credit"),i=-1;if(a.length<=0)return!0;var d=!1;switch(a.prop("tagName").toString().toLowerCase()){case"checkbox":d=a.is(":checked"),i=a.val();break;case"select":i=a.val(),i!="-1"&&(d=!0);break;default:break}if(!d||i==-1)return!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var c=t(r).html(),f=t.t("Flits.locals.cart_page.applying_credit_message","Applying credit please wait");switch(t(r).prop("tagName").toString().toLowerCase()){case"input":c=t(r).val(),t(r).val(f);break;case"button":default:c=t(r).html(),t(r).html(f);break}return t(r).attr("disabled",!0),t.StoreCreditCart.settings.checkoutProcessData={btn:r,btnOldTxt:c,event:e,spentRuleId:i},t.getCart().done(v).fail(function(){return t.redirectToCheckout({discount:"+"}),!1}),!1}function g(e,r){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var o=k(e,r);return o&&(t.StoreCreditCart.settings.isDeleteDiscount&&S(),t.redirectToCheckout({discount:"+"})),!1}function _(){if(t(document).on("click",'[data-flits="'+t.StoreCreditCart.settings.checkoutButtonParameterValue+'"]',function(r){var o=this;return g.apply(t.StoreCreditCart,[r,o])}),t(document).on("click",t.StoreCreditCart.settings.updateCartButtonSelectors.join(","),function(r){t(this).attr("data-flits","update-cart-btn")}),t(document).on("click",function(r){var o=r.target,a=!1;t.each(t(t.StoreCreditCart.settings.updateCartButtonSelectors.join(",")),function(i,d){if(t(o).is(t(this)))return a=!0,!1}),a||t("[data-flits='update-cart-btn']").removeAttr("data-flits")}),t(document).on("submit",t.StoreCreditCart.settings.checkoutFormSelectors.join(","),function(r,o){if(!t.isNull(o)&&o.flitsFormSubmitted||t(this).find("[data-flits='update-cart-btn']").length>0)return!0;var a=null;return r.originalEvent&&r.originalEvent.submitter&&(a=r.originalEvent.submitter),!a&&document.activeElement.type=="submit"&&(a=document.activeElement),a||(a=t(this).find("[type='submit'][data-flits='"+t.StoreCreditCart.settings.checkoutButtonParameterValue+"']")),a?g.apply(t.StoreCreditCart,[r,a]):!0}),t.StoreCreditCart.settings.isAjaxCart){t.addToCartAjaxEvent(),t.updateCartAjaxEvent(),t.clearCartAjaxEvent(),t.getCartAjaxEvent();var e=t.debounce(function(r){t.checkAndSetupStoreCreditDiv(),t.getCart().done(s)},2500);t(document).on("Flits:AjaxCart:ProductAdded",e),t(document).on("Flits:AjaxCart:CartUpdated",e),t(document).on("Flits:AjaxCart:CartRendered",e),t.dispatchEvent("Flits:AjaxCart:Setup",{debouncedFunction:e})}}function b(){if(t.StoreCreditCart.settings.isProcessCheckout=!0,window.globoStores){var e=!0;if(window.globoStores.settings.storePickup.dateTimePicker.datePicker&&t(window.globoStores.datePicker.$node).val()==""&&(e=!1),window.globoStores.settings.storePickup.dateTimePicker.timePicker&&t(window.globoStores.timePicker.$node).val()==""&&(e=!1),!e){t("#pickupDateTimeErrorMsg").show(),t.StoreCreditCart.settings.isProcessCheckout=!1;return}}if(window.Zapiet){var e=!1;if(window.Zapiet.Widget.checkoutEnabled()&&(e=!0),!e){t.StoreCreditCart.settings.isProcessCheckout=!1;return}}t.dispatchEvent("Flits:IsCheckoutPossible")}function P(){t.checkAndSetupStoreCreditDiv(),t.setLocalStorage("lastLoadedCart",{}),t.setLocalStorage("lastLoadedSpentRules",{}),t.getCart().done(s),_()}P()};t.extend({checkAndSetupStoreCreditDiv:function(){t.StoreCreditCart.settings.isCodeAutomatic?t(t.StoreCreditCart.settings.checkoutButtonSelectors.join(",")).appendStoreCreditDiv():(t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").parents(t.StoreCreditCart.settings.automaticCodeDiv).show(),t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").attr("data-flits-manual-code",!0),t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").parents(t.StoreCreditCart.settings.automaticCodeDiv).parent().find(t.StoreCreditCart.settings.checkoutButtonSelectors.join(",")).attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParameterValue),t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").parents(t.StoreCreditCart.settings.automaticCodeDiv).parent().attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParentParameterValue))}}),t.fn.extend({appendStoreCreditDropDown:function(m){return this.each(function(C,n){t(n).html(""),t(n).append(t(m).clone(!0))}),this},appendStoreCreditDiv:function(){var m=t.StoreCreditCart.settings;return this.filter(':not([data-flits="'+t.StoreCreditCart.settings.checkoutButtonParameterValue+'"])').each(function(C,n){if(n=t(n),n.css("display")!="none"&&n.css("visibility")!="hidden"){if(typeof n[0].addEventListener!="function")return;var s=t(t.StoreCreditCart.settings.creditDropDownHtml).find("."+t.StoreCreditCart.settings.main_div_class).clone(!0);t(s).removeClass("flits-template");var p=n.parent();n.before(s),n.attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParameterValue),p.attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParentParameterValue),t.StoreCreditCart.settings.automaticAppendDivFunction.apply(this,[n,p,s]),t.dispatchEvent("Flits:CartAutomaticCode:Loaded",{el:n,parent:p,cloneNode:s})}}),this}}),h(window.flitsObjects.StoreCreditCartPage)})(Flits);
//# sourceMappingURL=/s/files/1/0693/3459/7926/t/6/assets/flits_cart.js.map?v=1676150727
