
/****PLEASE DON'T MAKE CHANGES IN THIS FILE IT'S AFFECT THE CODE IF YOU NEED ANY HELP PLEASE CONTACT TO FLITS TEAM support@getflits.com ****/
(function(Flits){var orderStatusPage=Flits.orderStatusPage=function(){Flits.orderStatusPage.settings={};var settings={orderDate:Shopify.checkout.updated_at,storeCredit:{referenceElement:Flits('.section__content .content-box:eq(0)'),sectionElement:Flits("#shopify-section-flits_order_status_page .flits-store-credit-box"),responseData:null,noOfTimesRecall:1,noMoreRecallAfter:6,recallDelay:12000,totalEarnedCreditOnOrderText:Flits.t('Flits.locals.order_status_page.total_earned_credit_on_order','Congratulations! You have earned {{ credit }} credit on this purchase.'),currentCreditBalanceText:Flits.t('Flits.locals.order_status_page.total_credit_balance','Your total credit balance is {{ credit }}.'),shopMoreToEarnCreditText:Flits.t('Flits.locals.order_status_page.shop_more_to_earn_credit_html','Want to earn more credits and save big bucks? Then dive into our collection and shop more!'),shopMoreToSpentCreditText:Flits.t('Flits.locals.order_status_page.shop_more_to_spent_credit_html','Still have credits left? Shop more to utilise them all.')}};settings=Flits.extend(Flits.orderStatusPage.settings,settings);Flits.scOrderStatusAjaxRecall=function(){var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData;var currentDate=new Date;var orderDate=Flits.orderStatusPage.settings.orderDate;if(Flits.timeDiffer({date1:currentDate,date2:orderDate,type:'hour'})<=Flits.orderStatusPage.settings.storeCredit.noMoreRecallAfter){if(scResponseData.recall){setTimeout((function(){Flits.orderStatusPage.settings.storeCredit.noOfTimesRecall++;Flits.services.settings.scOrderStatusPageService();return}),Flits.orderStatusPage.settings.storeCredit.recallDelay);return true}}return false};Flits.checkSpentRuleOff=function(){var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData;if(!scResponseData.isOrderSpentRuleOn){var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;scSectionElement.remove();return true}return false};Flits.checkEarningRuleOff=function(){var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData;var currentCreditBalance=scResponseData.currentCreditBalance;if(!scResponseData.isOrderEarningRuleOn){if(currentCreditBalance<=0){scSectionElement.remove();return true}else{var currentCreditBalanceText=Flits.orderStatusPage.settings.storeCredit.currentCreditBalanceText;var shopMoreToSpentCreditText=Flits.orderStatusPage.settings.storeCredit.shopMoreToSpentCreditText;currentCreditBalance=Flits.formatMoney(Math.abs(currentCreditBalance),Flits.money_format);scSectionElement.find('.current-credit-balance').html(currentCreditBalanceText.replace('{{ credit }}',currentCreditBalance));scSectionElement.find('.shop-more-to-spent-credit').html(shopMoreToSpentCreditText);Flits.showCreditSection(scSectionElement);return true}}return false};Flits.checkEarningRuleOn=function(){var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData;var currentCreditBalance=scResponseData.currentCreditBalance;if(scResponseData.isOrderEarningRuleOn&&currentCreditBalance<=0){var shopMoreToEarnCreditText=Flits.orderStatusPage.settings.storeCredit.shopMoreToEarnCreditText;scSectionElement.find('.shop-more-to-earn-credit').html(shopMoreToEarnCreditText);Flits.showCreditSection(scSectionElement);return true}return false};Flits.setOrderCredit=function(){var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData;if(scResponseData.isLastOrder&&scResponseData.earnedCreditOnOrder&&scResponseData.earnedCreditOnOrder.credit>0){var earnedCreditOnOrder=scResponseData.earnedCreditOnOrder.credit;var totalEarnedCreditOnOrder=Flits.formatMoney(Math.abs(earnedCreditOnOrder),Flits.money_format);var totalEarnedCreditOnOrderText=Flits.orderStatusPage.settings.storeCredit.totalEarnedCreditOnOrderText;scSectionElement.find('.total-earned-credit-on-order').html(totalEarnedCreditOnOrderText.replace('{{ credit }}',totalEarnedCreditOnOrder));if(scResponseData.earnedCreditOnOrder.creditLogs.length>1){var productTagCreditfound=false;var productTagRuleModuleOn='';var earnedCreditOnProductTag=0;var productTagCreditText='';var productTagSpan=Flits('<span/>');Flits.each(scResponseData.earnedCreditOnOrder.creditLogs,(function(index,creditLog){var ruleModuleOn=creditLog.module_on;var defaultText='';switch(ruleModuleOn){case'order_number':var earnedCreditText=Flits.t('Flits.locals.order_status_page.earned_credit_on_'+ruleModuleOn,'You earned {{ credit }} credit for this order.');var earnedCredit=Flits.formatMoney(Math.abs(creditLog.credits),Flits.money_format);earnedCreditText=earnedCreditText.replace('{{ credit }}',earnedCredit);scSectionElement.find('.earned-credit-on-'+ruleModuleOn).html(earnedCreditText);break;case'product_tag':productTagRuleModuleOn=ruleModuleOn;productTagCreditfound=true;productTagCreditText=Flits.t('Flits.locals.order_status_page.earned_credit_on_'+ruleModuleOn,'You earned {{ credit }} credit by purchasing from {{ tag }} collection.');earnedCreditOnProductTag+=parseFloat(creditLog.credits);if(creditLog.tags){Flits(creditLog.tags).each((function(index,item){let productTagAnchor=Flits('<a href="/search?q='+item+'" target="_blank" class="flits-link">'+item+'</a>');if(productTagSpan.text()!=''){productTagSpan.append(', ')}productTagSpan.append(productTagAnchor)}))}break;default:break}}));if(productTagCreditfound){var earnedCredit=Flits.formatMoney(Math.abs(earnedCreditOnProductTag),Flits.money_format);var earnedCreditText=productTagCreditText.replace('{{ credit }}',earnedCredit).replace('{{ tag }}',productTagSpan.html());scSectionElement.find('.earned-credit-on-'+productTagRuleModuleOn).html(earnedCreditText);scSectionElement.find('.earned-credit-ul').show()}}else{scSectionElement.find('.earned-credit-ul').remove()}}else{scSectionElement.find('.earned-credit-ul').remove()}};Flits.showCreditSection=function(scSectionElement){scSectionElement.find('.flits-skeleton-row').fadeOut(200,(function(){scSectionElement.find('.flits-order-credit-row').children(':empty').remove();scSectionElement.find('.flits-order-credit-row').fadeIn(100,(function(){Flits.setCreditSectionMargin(scSectionElement)}))}))};Flits.setCreditSectionMargin=function(scSectionElement){var removeMargin=false;scSectionElement.find('.flits-order-credit-row').children(":visible").each(((index,element)=>{if(Flits(element).text()==''){Flits(element).css("margin-top","0px")}else{if(!removeMargin){Flits(element).css("margin-top","0px");removeMargin=true}}}))};Flits(document).on('Flits:scOrderStatusPage:AjaxSuccessful',(function(event){var scResponseData=Flits.orderStatusPage.settings.storeCredit.responseData=event.detail.resp;var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;if(scResponseData.status){if(Flits.scOrderStatusAjaxRecall()){return}if(Flits.checkSpentRuleOff()||Flits.checkEarningRuleOff()||Flits.checkEarningRuleOn()){return}if(!scResponseData.isOrderCancelled){Flits.setOrderCredit()}var currentCreditBalance=scResponseData.currentCreditBalance;if(currentCreditBalance>0){currentCreditBalance=Flits.formatMoney(Math.abs(currentCreditBalance),Flits.money_format);var currentCreditBalanceText=Flits.orderStatusPage.settings.storeCredit.currentCreditBalanceText;scSectionElement.find('.current-credit-balance').html(currentCreditBalanceText.replace('{{ credit }}',currentCreditBalance))}var shopMoreToEarnCreditText=Flits.orderStatusPage.settings.storeCredit.shopMoreToEarnCreditText;scSectionElement.find('.shop-more-to-earn-credit').html(shopMoreToEarnCreditText);Flits.showCreditSection(scSectionElement)}else{if(scResponseData.errorCode==2){if(Flits.scOrderStatusAjaxRecall()){return}}scSectionElement.remove()}}));var scSectionElement=Flits.orderStatusPage.settings.storeCredit.sectionElement;if(flitsObjects.global.Metafields.ORDER_STATUS_PAGE.isStoreCreditEnable){var scReferenceElement=Flits.orderStatusPage.settings.storeCredit.referenceElement;scReferenceElement.after(scSectionElement);scSectionElement.show();Flits.services.settings.scOrderStatusPageService()}else{scSectionElement.remove()}};Flits.extend({services:function(){Flits.services.settings={};var settings={scOrderStatusPageService:null};settings=Flits.extend(Flits.services.settings,settings);var customerId=Shopify.checkout.customer_id;var orderId=Shopify.checkout.order_id;var getOrderCreditUrl=Flits.base_url+"/"+customerId+"/"+orderId+"/get_credit";var encodedData=Flits.encodeData(customerId);if(encodedData.encodedValue){Flits.customerHash=Flits.partialCustomerHash+encodedData.encodedValue}Flits.services.settings.scOrderStatusPageService=function(callBack){Flits.ajax({method:"GET",url:getOrderCreditUrl,data:{noOfTimesRecall:Flits.orderStatusPage.settings.storeCredit.noOfTimesRecall,customer_hash:Flits.customerHash,token:Flits.token,customerHashKey:encodedData['randomString'],orderDate:Flits.orderStatusPage.settings.orderDate}}).done((function(resp){Flits.dispatchEvent('Flits:scOrderStatusPage:AjaxSuccessful',{resp:resp});if(callBack){callBack(resp)}})).fail((function(resp){})).always((function(){}))};Flits.dispatchEvent('Flits:services:Loaded',{settings:settings})},randomString:function(length){var possible='abcdefghijklmnopqrstuvwxyz';var text='';for(var i=0;i<length;i++){text+=possible.charAt(Math.floor(Math.random()*possible.length))}return text},encodeData:function(data){data=data.toString();var randomString=Flits.randomString(10);var chars=randomString.split("");var oddOnes=[];var evenOnes=[];for(var i=0;i<data.length;i++){i%2==0?evenOnes.push(data[i]):oddOnes.push(data[i])}data=evenOnes.join("")+oddOnes.join("");return{'encodedValue':data.replace(/[0123456789]/g,(m=>chars[m])),'randomString':randomString}}});if(flitsObjects.global.Metafields.ORDER_STATUS_PAGE){Flits.services();Flits.orderStatusPage()}})(Flits);
